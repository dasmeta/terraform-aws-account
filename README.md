# terraform-aws-account

## this module allows to configure aws account level resources which are not part to specific environment/application and are global impact on aws

## basic example
```hcl
module "account" {
  source  = "dasmeta/account/aws"
  version = "x.y.z"

  create_cloudwatch_log_role = true
}
```

## upgrade guide
- from <=1.3.7 to >=1.3.8
  - if you have had `cost_report_export` and `account_events_export` used it is possible that after update to new version it will show some additional delete/create resources and will fail at firs apply. This is ok and there is need to plan apply one more time to get the needed resources related to account cost and events export created.
- from <=1.3.9 to >=1.4.0 (BREAKING change related to security-hub configuration)
  we have improvements in security-hub enable and notification channels configuration,
  there is new variable named `security_hub`, which allows to enable security hub and with `alarm_actions.security_hub_alarms` variable we configure security-hub notification, by default the notifications go through account level configured channels, but it is possible to enable custom notification channels via custom sns topic, more info/example can be fount in test/example from ./tests/security-hub-findings-to-slack folder
  with the new version we also added support for terraform provider 6.x
<!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | ~> 1.3 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | >= 5.0, < 7.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | >= 5.0, < 7.0 |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_account_events_export"></a> [account\_events\_export](#module\_account\_events\_export) | ./modules/account-events-export | n/a |
| <a name="module_account_events_export_virginia"></a> [account\_events\_export\_virginia](#module\_account\_events\_export\_virginia) | ./modules/account-events-export | n/a |
| <a name="module_buckets"></a> [buckets](#module\_buckets) | dasmeta/s3/aws | 1.3.3 |
| <a name="module_cloudtrail"></a> [cloudtrail](#module\_cloudtrail) | dasmeta/modules/aws//modules/cloudtrail/ | 2.18.3 |
| <a name="module_cloudwatch_alarm_actions"></a> [cloudwatch\_alarm\_actions](#module\_cloudwatch\_alarm\_actions) | dasmeta/monitoring/aws//modules/cloudwatch-alarm-actions | 1.21.0 |
| <a name="module_cloudwatch_alarm_actions_virginia"></a> [cloudwatch\_alarm\_actions\_virginia](#module\_cloudwatch\_alarm\_actions\_virginia) | dasmeta/monitoring/aws//modules/cloudwatch-alarm-actions | 1.21.0 |
| <a name="module_cost_report_export"></a> [cost\_report\_export](#module\_cost\_report\_export) | ./modules/cost-report-export | n/a |
| <a name="module_enforce_mfa"></a> [enforce\_mfa](#module\_enforce\_mfa) | terraform-module/enforce-mfa/aws | ~> 1.0 |
| <a name="module_enforce_mfa_group"></a> [enforce\_mfa\_group](#module\_enforce\_mfa\_group) | terraform-aws-modules/iam/aws//modules/iam-group-with-policies | 5.47.1 |
| <a name="module_groups"></a> [groups](#module\_groups) | terraform-aws-modules/iam/aws//modules/iam-group-with-policies | 5.47.1 |
| <a name="module_monitoring_billing"></a> [monitoring\_billing](#module\_monitoring\_billing) | dasmeta/monitoring/aws//modules/billing | 1.21.0 |
| <a name="module_monitoring_security_hub"></a> [monitoring\_security\_hub](#module\_monitoring\_security\_hub) | dasmeta/monitoring/aws//modules/security-hub | 1.21.0 |
| <a name="module_password_policy"></a> [password\_policy](#module\_password\_policy) | dasmeta/modules/aws//modules/iam-account-password-policy | 2.18.0 |
| <a name="module_secrets"></a> [secrets](#module\_secrets) | dasmeta/modules/aws//modules/secret | 2.18.0 |
| <a name="module_users"></a> [users](#module\_users) | dasmeta/iam/aws//modules/user | 1.2.1 |

## Resources

| Name | Type |
|------|------|
| [aws_caller_identity.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/caller_identity) | data source |
| [aws_region.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/region) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_account_events_export"></a> [account\_events\_export](#input\_account\_events\_export) | Allows to configure and stream aws account important events to specified `webhook_endpoint`, NOTE: webhook\_endpoint is required when enabling this | <pre>object({<br/>    enabled          = optional(bool, false)<br/>    webhook_endpoint = optional(string, null)                    # required if enabled, this is endpoint to which the events will be sent via POST request<br/>    name             = optional(string, "account-events-export") # the identifier part used for lambda function and event bridge subscription<br/>    event_bridge_bus = optional(object({<br/>      create              = optional(bool, false)                                                                                                                                                                                                                                                                                                                                                                                                                                             # whether to create event bridge bus, there is default bus name 'default' what can be used without creating separate one<br/>      name                = optional(string, "default")                                                                                                                                                                                                                                                                                                                                                                                                                                       # the bus name, default bus pre-exist and we can use it<br/>      rule_pattern_source = optional(list(string), ["aws.ec2", "aws.s3", "aws.rds", "aws.eks", "aws.sqs", "aws.lambda", "aws.iam", "aws.vpc", "custom.test", "aws.route53", "aws.cloudfront", "aws.acm", "aws.cloudwatch", "aws.amplify", "aws.health", "aws.securityhub", "aws.budgets", "aws.secretsmanager", "aws.events", "aws.autoscaling", "aws.elasticache", "aws.elb", "aws.amazonmq", "aws.apigateway", "aws.waf", "aws.waf-regional", "aws.savingsplans", "aws.opensearchservice"]) # The list of aws services to capture and stream/export event, for available event sources check https://docs.aws.amazon.com/eventbridge/latest/ref/events.html<br/>    }), {})<br/>  })</pre> | `{}` | no |
| <a name="input_alarm_actions"></a> [alarm\_actions](#input\_alarm\_actions) | Whether to enable/create regional(TODO: add also us-east-1 region alarm also for health-check alarms) SNS topic/subscribers | <pre>object({<br/>    enabled                  = optional(bool, false)                       # Enable/disable alarm actions module for account-level notifications<br/>    topic_name               = optional(string, "account-alarms-handling") # SNS topic name for account alarms. If empty, defaults to "account-alarms-handling"<br/>    enable_dead_letter_queue = optional(bool, false)                       # Whether to enable dead letter queue (SQS) for failed Lambda invocations<br/>    email_addresses          = optional(list(string), [])                  # List of email addresses to receive alarm notifications<br/>    phone_numbers            = optional(list(string), [])                  # List of international formatted phone numbers (e.g., "+1234567890") to receive SMS notifications<br/>    web_endpoints            = optional(list(string), [])                  # List of webhook endpoints (e.g., Opsgenie, PagerDuty) to receive HTTP POST notifications<br/>    lambda_arns              = optional(list(string), [])                  # List of Lambda function ARNs to invoke when alarms are triggered. Note: Lambda functions must be in the same region as the SNS topic<br/>    teams_webhooks           = optional(list(string), [])                  # List of Microsoft Teams webhook URLs for sending notifications to Teams channels<br/>    log_group_retention_days = optional(number, 7)                         # Number of days to retain CloudWatch Logs for Lambda functions (default: 7 days)<br/>    slack_webhooks = optional(list(object({                                # List of Slack webhook configurations for sending notifications to Slack channels<br/>      hook_url = string                                                    # Slack webhook URL<br/>      channel  = string                                                    # Slack channel name (e.g., "#alerts")<br/>      username = string                                                    # Bot username for Slack messages<br/>    })), [])<br/>    servicenow_webhooks = optional(list(object({ # List of ServiceNow webhook configurations for creating incidents in ServiceNow<br/>      domain = string                            # ServiceNow instance domain (e.g., "yourcompany.service-now.com")<br/>      path   = string                            # API endpoint path<br/>      user   = string                            # ServiceNow username<br/>      pass   = string                            # ServiceNow password or API token<br/>    })), [])<br/>    billing_alarm = optional(object({                                                         # Allows to setup billing (cost exceeded) alarm for aws account, NOTE: you have to at first enable 'alarm_actions' and then enable this<br/>      enabled                = optional(bool, false)                                          # Enable/disable billing alarm for cost monitoring<br/>      name                   = optional(string, "Account-Monthly-Budget")                     # Name of the AWS Budget for cost monitoring<br/>      limit_amount           = optional(string, "200")                                        # Budget limit amount (as string, e.g., "200")<br/>      limit_unit             = optional(string, "USD")                                        # Budget limit unit (e.g., "USD")<br/>      time_unit              = optional(string, "MONTHLY")                                    # Budget time unit: MONTHLY, QUARTERLY, or ANNUALLY<br/>      time_period_start      = optional(string, "2022-01-01_00:00")                           # Budget start date in format YYYY-MM-DD_HH:MM<br/>      time_period_end        = optional(string, "2087-06-15_00:00")                           # Budget end date in format YYYY-MM-DD_HH:MM<br/>      thresholds             = optional(list(string), ["40", "60", "80", "90", "100", "110"]) # List of threshold percentages at which to trigger alerts (e.g., ["40", "60", "80"])<br/>      threshold_type         = optional(string, "PERCENTAGE")                                 # Threshold type: PERCENTAGE or ABSOLUTE_VALUE<br/>      comparison_operator    = optional(string, "GREATER_THAN")                               # Comparison operator: GREATER_THAN, LESS_THAN, EQUAL_TO<br/>      notification_type      = optional(string, "ACTUAL")                                     # Notification type: ACTUAL or FORECASTED<br/>      notify_email_addresses = optional(list(string), [])                                     # List of email addresses to receive billing alarm notifications<br/>    }), { enabled : false })<br/>    security_hub_alarms = optional(object({                           # Allows to enable security hub alarm actions, by default it will use account level sns topic for security hub alarms, if you want to use custom alarm actions, you can set use_account_topic to false and set custom_alarm_actions to a map of alarm actions or a list of alarm actions<br/>      enabled           = optional(bool, false)                       # whether to enable security hub alarm actions, if false, will not create any alarm actions<br/>      use_account_topic = optional(bool, true)                        # whether to use account level sns topic(and notification channels) for security hub alarms, if false, will create separate sns topic for it<br/>      custom_alarm_actions = optional(object({                        # custom alarm actions to be used for security hub alarms, this get enabled when security_hub_alarms.enabled is true and security_hub_alarms.use_account_topic is false<br/>        topic_name                       = optional(string, "")       # Takes affect if use_account_topic is false. SNS topic name. If empty and create_topic=false, will use existing topic from alarm_actions module<br/>        create_topic                     = optional(bool, true)       # Takes affect if use_account_topic is false. Whether to create a new SNS topic. Set to false to reuse existing topic from alarm_actions module<br/>        topic_assign_security_hub_policy = optional(bool, true)       # Whether to assign the default security hub policy to the SNS topic<br/>        email_addresses                  = optional(list(string), []) # List of email addresses to receive Security Hub findings notifications<br/>        fallback_email_addresses         = optional(list(string), []) # List of fallback email addresses to receive notifications when primary channels fail<br/>        phone_numbers                    = optional(list(string), []) # List of international formatted phone numbers (e.g., "+1234567890") to receive SMS notifications<br/>        fallback_phone_numbers           = optional(list(string), []) # List of fallback phone numbers for SMS notifications when primary channels fail<br/>        web_endpoints                    = optional(list(string), []) # List of webhook endpoints (e.g., Opsgenie, PagerDuty) to receive HTTP POST notifications<br/>        fallback_web_endpoints           = optional(list(string), []) # List of fallback webhook endpoints when primary channels fail<br/>        lambda_arns                      = optional(list(string), []) # List of Lambda function ARNs to invoke when Security Hub findings are received. Note: Lambda functions must be in the same region as the SNS topic<br/>        fallback_lambda_arns             = optional(list(string), []) # List of fallback Lambda function ARNs when primary channels fail<br/>        slack_webhooks = optional(list(object({                       # List of Slack webhook configurations for sending notifications to Slack channels<br/>          hook_url = string                                           # Slack webhook URL<br/>          channel  = string                                           # Slack channel name (e.g., "#security-alerts")<br/>          username = string                                           # Bot username for Slack messages<br/>        })), [])<br/>        servicenow_webhooks = optional(list(object({ # List of ServiceNow webhook configurations for creating incidents in ServiceNow<br/>          domain = string                            # ServiceNow instance domain (e.g., "yourcompany.service-now.com")<br/>          path   = string                            # API endpoint path<br/>          user   = string                            # ServiceNow username<br/>          pass   = string                            # ServiceNow password or API token<br/>        })), [])<br/>        teams_webhooks = optional(list(string), []) # List of Microsoft Teams webhook URLs for sending notifications to Teams channels<br/>        jira_config = optional(list(object({        # List of Jira configurations for creating tickets for Security Hub findings<br/>          url            = string                   # Jira instance URL (e.g., "https://yourcompany.atlassian.net")<br/>          key            = string                   # Jira project key<br/>          user_username  = string                   # Jira username<br/>          user_api_token = string                   # Jira API token<br/>        })), [])<br/>        delivery_policy          = optional(any, null)      # SNS topic delivery policy for retry and throttling configuration. Controls how SNS retries message delivery to endpoints<br/>        policy                   = optional(any, null)      # SNS topic policy (IAM policy document) for controlling access to the topic. If null, uses default policy allowing EventBridge to publish<br/>        log_group_retention_days = optional(number, 7)      # Number of days to retain CloudWatch Logs for Lambda functions (default: 7 days)<br/>        enable_dead_letter_queue = optional(bool, true)     # Whether to enable dead letter queue (SQS) for failed Lambda invocations<br/>        recreate_missing_package = optional(bool, true)     # Whether to recreate missing Lambda deployment packages if they are missing locally<br/>        log_level                = optional(string, "INFO") # Log level for Lambda functions ("DEBUG", "INFO", "WARNING", "ERROR")<br/>        lambda_failed_alert = optional(any, {               # CloudWatch alarm configuration for monitoring Lambda function failures. Triggers when Lambda functions fail to process notifications<br/>          period    = 60                                    # Evaluation period in seconds<br/>          threshold = 1                                     # Number of failures to trigger alarm<br/>          equation  = "gte"                                 # Comparison operator (greater than or equal)<br/>          statistic = "sum"                                 # Statistic type (sum, average, etc.)<br/>        })<br/>      }), {})<br/>    }), {})<br/>  })</pre> | <pre>{<br/>  "billing_alarm": {<br/>    "enabled": false<br/>  },<br/>  "enabled": false,<br/>  "security_hub_alarms": {<br/>    "enabled": false<br/>  }<br/>}</pre> | no |
| <a name="input_alarm_actions_virginia"></a> [alarm\_actions\_virginia](#input\_alarm\_actions\_virginia) | Whether to enable/create regional(TODO: add also us-east-1 region alarm also for health-check alarms) SNS topic/subscribers | <pre>object({<br/>    enabled                  = optional(bool, false)<br/>    topic_name               = optional(string, "account-alarms-handling")<br/>    enable_dead_letter_queue = optional(bool, false)<br/>    email_addresses          = optional(list(string), [])<br/>    phone_numbers            = optional(list(string), [])<br/>    web_endpoints            = optional(list(string), [])<br/>    lambda_arns              = optional(list(string), [])<br/>    teams_webhooks           = optional(list(string), [])<br/>    log_group_retention_days = optional(number, 7)<br/>    slack_webhooks = optional(list(object({<br/>      hook_url = string<br/>      channel  = string<br/>      username = string<br/>    })), [])<br/>    servicenow_webhooks = optional(list(object({<br/>      domain = string<br/>      path   = string<br/>      user   = string<br/>      pass   = string<br/>    })), [])<br/>    billing_alarm = optional(object({ # Allows to setup billing (cost exceeded) alarm for aws account, NOTE: you have to at first enable 'alarm_actions' and then enable this<br/>      enabled                = optional(bool, false)<br/>      name                   = optional(string, "Account-Monthly-Budget")<br/>      limit_amount           = optional(string, "200")<br/>      limit_unit             = optional(string, "USD")<br/>      time_unit              = optional(string, "MONTHLY")<br/>      time_period_start      = optional(string, "2022-01-01_00:00")<br/>      time_period_end        = optional(string, "2087-06-15_00:00")<br/>      threshold              = optional(string, "200")<br/>      threshold_type         = optional(string, "PERCENTAGE")<br/>      comparison_operator    = optional(string, "GREATER_THAN")<br/>      notification_type      = optional(string, "ACTUAL")<br/>      notify_email_addresses = optional(list(string), [])<br/>    }), { enabled : false })<br/>    security_hub_alarms = optional(object({ # Allows to enable security hub for aws account, create separate sns topic for it and setup opsgenie subscriber.<br/>      enabled                                = optional(bool, false)<br/>      opsgenie_webhook                       = optional(string, null)<br/>      securityhub_action_target_name         = optional(string, "Send-to-SNS")<br/>      sns_topic_name                         = optional(string, "Send-to-Opsgenie")<br/>      protocol                               = optional(string, "https")<br/>      link_mode                              = optional(string, "ALL_REGIONS")<br/>      enable_security_hub                    = optional(bool, true) # not confuse with enabled option, this one is for setting "false" in case when aws security hub service already enabled<br/>      enable_security_hub_finding_aggregator = optional(bool, true)<br/>    }), { enabled : false })<br/>  })</pre> | <pre>{<br/>  "billing_alarm": {<br/>    "enabled": false<br/>  },<br/>  "enabled": false,<br/>  "security_hub_alarms": {<br/>    "enabled": false<br/>  }<br/>}</pre> | no |
| <a name="input_buckets"></a> [buckets](#input\_buckets) | List of buckets | <pre>list(object({<br/>    name                    = string<br/>    acl                     = optional(string, "private") # the bucket acl which cant be null in new s3 module<br/>    ignore_public_acls      = optional(bool, true)<br/>    restrict_public_buckets = optional(bool, true)<br/>    block_public_acls       = optional(bool, true)<br/>    block_public_policy     = optional(bool, true)<br/>    versioning              = optional(map(string), { enabled = true })<br/>    website                 = optional(map(string), {})<br/>    create_index_html       = optional(bool, false)<br/>    create_iam_user         = optional(bool, false)<br/>    bucket_files            = optional(object({ path = string }), { path = "" })<br/>  }))</pre> | `[]` | no |
| <a name="input_cloudtrail"></a> [cloudtrail](#input\_cloudtrail) | Cloudtrail configuration | <pre>object({<br/>    enabled                          = optional(bool, false)<br/>    enable_cloudwatch_logs           = optional(bool, false)<br/>    name                             = optional(string, "audit") # Name of CloudTrail<br/>    bucket_name                      = optional(string, "")      # Whether to create new fresh bucket or use existing one, if set non empty it will use existing one with provided name<br/>    create_s3_bucket                 = optional(bool, true)<br/>    include_global_service_events    = optional(bool, true)   # Specifies whether the trail is publishing events from global services such as IAM to the log files<br/>    enable_log_file_validation       = optional(bool, true)   # Specifies whether log file integrity validation is enabled. Creates signed digest for validated contents of logs<br/>    is_organization_trail            = optional(bool, true)   # The trail is an AWS Organizations trail<br/>    is_multi_region_trail            = optional(bool, true)   # Specifies whether the trail is created in the current region or in all regions<br/>    cloud_watch_logs_group_arn       = optional(string, "")   # Specifies a log group name using an Amazon Resource Name (ARN), that represents the log group to which CloudTrail logs will be delivered<br/>    cloud_watch_logs_role_arn        = optional(string, "")   # Specifies the role for the CloudWatch Logs endpoint to assume to write to a userâ€™s log group<br/>    cloud_watch_logs_group_retention = optional(number, 90)   # Specifies the number of days you want to retain log events in the specified log group.<br/>    enable_logging                   = optional(bool, true)   # Enable logging for the trail<br/>    sns_topic_name                   = optional(string, null) # Specifies the name of the Amazon SNS topic defined for notification of log file delivery<br/>    event_selector = optional(list(object({                   # Specifies an event selector for enabling data event logging. See: https://www.terraform.io/docs/providers/aws/r/cloudtrail.html for details on this variable<br/>      include_management_events = bool<br/>      read_write_type           = string<br/><br/>      data_resource = list(object({<br/>        type   = string<br/>        values = list(string)<br/>      }))<br/>    })), [])<br/>    insight_selectors = optional(list(string), [])<br/>    alerts_events     = optional(list(string), ["iam-user-creation-or-deletion"]) # Some possible values are: iam-user-creation-or-deletion, iam-role-creation-or-deletion, iam-policy-changes, s3-creation-or-deletion, root-account-usage, elastic-ip-association-and-disassociation and etc.<br/>  })</pre> | <pre>{<br/>  "enabled": false<br/>}</pre> | no |
| <a name="input_cost_report_export"></a> [cost\_report\_export](#input\_cost\_report\_export) | Allows to configure and get cost report of previous day to specified `webhook_endpoint`, NOTE: webhook\_endpoint is required when enabling this | <pre>object({<br/>    enabled                = optional(bool, false)<br/>    webhook_endpoint       = optional(string, null)                  # required if enabled, this is endpoint to which the report will be sent via POST request<br/>    name                   = optional(string, "account-cost-report") # the identifier part used for lambda function and event bridge cronjob schedule namings<br/>    logs_retention_in_days = optional(number, 7)                     # the retention days of logs in cloudwatch for lambda function which sent cost data to webhook endpoint<br/>    event_bridge_bus = optional(object({<br/>      create   = optional(bool, false)                 # whether to create event bridge bus, there is default bus name 'default' what can be used without creating separate one<br/>      name     = optional(string, "default")           # the bus name, default bus pre-exist and we can use it<br/>      schedule = optional(string, "cron(0 5 * * ? *)") # schedule to collect cost data, by default we use once a day at 05:00 AM UTC schedule to collect previous day data 'cron(0 5 * * ? *)'<br/>      timezone = optional(string, "Europe/London")<br/>    }), {})<br/>  })</pre> | `{}` | no |
| <a name="input_create_cloudwatch_log_role"></a> [create\_cloudwatch\_log\_role](#input\_create\_cloudwatch\_log\_role) | This is an account level configuration which creates IAM role with policy allowing cloudwatch sync/push logs into cloudwatch | `bool` | `false` | no |
| <a name="input_enforce_mfa"></a> [enforce\_mfa](#input\_enforce\_mfa) | MFA related configs, set the name for enforce MFA IAM user group value to null if you want this group to not be created | <pre>object({<br/>    enabled                           = optional(bool, true) # whether to create enforce mfa iam group<br/>    group_name                        = optional(string, "enforce-mfa")<br/>    policy_name                       = optional(string, "mfa-enforce-policy")<br/>    manage_own_signing_certificates   = optional(bool, true)<br/>    manage_own_ssh_public_keys        = optional(bool, true)<br/>    manage_own_git_credentials        = optional(bool, true)<br/>    attach_iam_self_management_policy = optional(bool, false)<br/>  })</pre> | `{}` | no |
| <a name="input_groups"></a> [groups](#input\_groups) | n/a | <pre>list(object({<br/>    name                              = string<br/>    custom_group_policies             = optional(list(map(string)), [])<br/>    custom_group_policy_arns          = optional(list(string), [])<br/>    attach_iam_self_management_policy = optional(bool, false)<br/>    users                             = optional(list(string), [])<br/>  }))</pre> | `[]` | no |
| <a name="input_password_policy"></a> [password\_policy](#input\_password\_policy) | Allows to create/set aws iam users password policy for better security | <pre>object({<br/>    enabled                        = optional(bool, true)<br/>    allow_users_to_change_password = optional(bool, true)<br/>    minimum_password_length        = optional(number, 16)<br/>    require_lowercase_characters   = optional(bool, true)<br/>    require_numbers                = optional(bool, true)<br/>    require_symbols                = optional(bool, true)<br/>    require_uppercase_characters   = optional(bool, true)<br/>    max_password_age               = optional(number, 90)<br/>    hard_expiry                    = optional(bool, false)<br/>    password_reuse_prevention      = optional(number, 5)<br/>  })</pre> | `{}` | no |
| <a name="input_secrets"></a> [secrets](#input\_secrets) | Allows to create account level aws secret manager secret for storing global/shared secrets, which supposed can be used by all services/apps/environments | <pre>object({<br/>    enabled                 = optional(bool, false)<br/>    name                    = optional(string, "account")<br/>    value                   = optional(any, null)<br/>    recovery_window_in_days = optional(number, 30)<br/>  })</pre> | `{}` | no |
| <a name="input_security_hub"></a> [security\_hub](#input\_security\_hub) | AWS Security Hub configuration with submodules (Config, Inspector, GuardDuty, Macie) and alarm actions for findings notifications | <pre>object({<br/>    enabled = optional(bool, false) # Enable/disable Security Hub and its submodules<br/>    name    = optional(string, "account-security-hub")<br/>    # Security Hub configuration<br/>    enable_security_hub                    = optional(bool, true)            # Whether to enable Security Hub service. Set to false if Security Hub is already enabled<br/>    enable_security_hub_finding_aggregator = optional(bool, true)            # Whether to enable Security Hub finding aggregator for multi-region/account aggregation<br/>    link_mode                              = optional(string, "ALL_REGIONS") # Linking mode for finding aggregator: ALL_REGIONS, SPECIFIED_REGIONS, or ALL<br/>    specified_regions                      = optional(list(string), [])      # List of regions for SPECIFIED_REGIONS link mode<br/>    enabled_standards = optional(set(string), [                              # Security Hub standards to enable. Available standards:<br/>      "aws-foundational-security-best-practices/v/1.0.0",                    # AWS Foundational Security Best Practices v1.0.0 (default)<br/>      "cis-aws-foundations-benchmark/v/1.2.0"                                # CIS AWS Foundations Benchmark v1.2.0 (default)<br/>      # "cis-aws-foundations-benchmark/v/1.4.0"                             # CIS AWS Foundations Benchmark v1.4.0<br/>      # "cis-aws-foundations-benchmark/v/3.0.0"                             # CIS AWS Foundations Benchmark v3.0.0<br/>      # "cis-aws-foundations-benchmark/v/5.0.0"                             # CIS AWS Foundations Benchmark v5.0.0<br/>      # "aws-resource-tagging-standard/v/1.0.0"                             # AWS Resource Tagging Standard v1.0.0<br/>      # "nist-800-171-rev2/v/1.0.0"                                         # NIST Special Publication 800-171 Revision 2<br/>      # "nist-800-53-rev5/v/1.0.0"                                          # NIST Special Publication 800-53 Revision 5<br/>      # "pci-dss/v/3.2.1"                                                   # PCI DSS v3.2.1<br/>      # "pci-dss/v/4.0.1"                                                   # PCI DSS v4.0.1<br/>    ])<br/>    action_target_name  = optional(string, "SendNotification") # Name of the Security Hub action target for manual triggers<br/>    securityhub_members = optional(map(string), {})            # Map of email -> account_id for Security Hub member accounts<br/>    # AWS Config submodule configuration<br/>    config = optional(object({<br/>      enabled                    = optional(bool, true)                 # Enable/disable AWS Config. REQUIRED for Security Hub standards to work properly<br/>      create_service_linked_role = optional(bool, true)                 # Whether to create the AWS Config service-linked role. Set to false if the role already exists<br/>      record_all_resources       = optional(bool, true)                 # Record all supported resource types in AWS Config<br/>      include_global_resources   = optional(bool, true)                 # Include global resources (IAM, etc.) in AWS Config recording<br/>      s3_bucket_name             = optional(string, "")                 # S3 bucket name for AWS Config. If empty, a bucket will be created automatically<br/>      s3_bucket_force_destroy    = optional(bool, false)                # Force destroy S3 bucket for Config when deleting the module<br/>      delivery_frequency         = optional(string, "TwentyFour_Hours") # Frequency for Config snapshot delivery<br/>      included_resource_types    = optional(list(string), [])           # List of resource types to include when record_all_resources is false<br/>      excluded_resource_types    = optional(list(string), [])           # List of resource types to exclude when record_all_resources is true<br/>      rules = optional(map(object({                                     # Map of Config rules to create<br/>        description = optional(string)<br/>        source = optional(object({<br/>          owner             = string<br/>          source_identifier = string<br/>          source_detail = optional(list(object({<br/>            event_source                = optional(string)<br/>            maximum_execution_frequency = optional(string)<br/>            message_type                = optional(string)<br/>          })))<br/>        }))<br/>        scope = optional(object({<br/>          compliance_resource_types = optional(list(string))<br/>          compliance_resource_id    = optional(string)<br/>          tag_key                   = optional(string)<br/>          tag_value                 = optional(string)<br/>        }))<br/>        input_parameters = optional(string)<br/>        tags             = optional(map(string))<br/>      })), {})<br/>    }), {})<br/>    # AWS Inspector submodule configuration<br/>    inspector = optional(object({<br/>      enabled        = optional(bool, true)                                            # Enable/disable AWS Inspector v2. RECOMMENDED for EC2/EKS vulnerability scanning<br/>      resource_types = optional(list(string), ["EC2", "ECR", "LAMBDA", "LAMBDA_CODE"]) # Resource types to enable Inspector for. Valid values: EC2, ECR, LAMBDA, LAMBDA_CODE, CODE_REPOSITORY. LAMBDA scans Lambda function configuration (runtime, permissions). LAMBDA_CODE scans Lambda function code (dependencies, vulnerabilities). Both are recommended for comprehensive Lambda scanning<br/>      filters = optional(map(object({                                                  # Map of findings filters to create. Key is the filter name. If empty, no filters will be created<br/>        description   = optional(string)                                               # Filter description<br/>        filter_action = string                                                         # Filter action. Valid values: ARCHIVE (suppress findings), NOOP (no action)<br/>        filter_criteria = optional(object({                                            # Filter criteria for matching findings<br/>          aws_account_id = optional(object({                                           # Filter by AWS account ID<br/>            comparison = string                                                        # Comparison operator (EQUALS, PREFIX, NOT_EQUALS)<br/>            value      = string                                                        # Account ID value<br/>          }))<br/>          component_id = optional(object({ # Filter by component ID<br/>            comparison = string<br/>            value      = string<br/>          }))<br/>          component_type = optional(object({ # Filter by component type<br/>            comparison = string<br/>            value      = string<br/>          }))<br/>          ec2_instance_image_id = optional(object({ # Filter by EC2 instance AMI ID<br/>            comparison = string<br/>            value      = string<br/>          }))<br/>          ec2_instance_subnet_id = optional(object({ # Filter by EC2 instance subnet ID<br/>            comparison = string<br/>            value      = string<br/>          }))<br/>          ec2_instance_vpc_id = optional(object({ # Filter by EC2 instance VPC ID<br/>            comparison = string<br/>            value      = string<br/>          }))<br/>          ecr_image_pushed_at = optional(object({ # Filter by ECR image push date/time<br/>            end_inclusive   = optional(string)    # End date (ISO 8601 format)<br/>            start_inclusive = optional(string)    # Start date (ISO 8601 format)<br/>          }))<br/>          ecr_image_tags = optional(object({ # Filter by ECR image tags<br/>            comparison = string<br/>            value      = string<br/>          }))<br/>          ecr_image_hash = optional(object({ # Filter by ECR image hash<br/>            comparison = string<br/>            value      = string<br/>          }))<br/>          finding_arn = optional(object({ # Filter by finding ARN<br/>            comparison = string<br/>            value      = string<br/>          }))<br/>          finding_status = optional(object({ # Filter by finding status (ACTIVE, SUPPRESSED, CLOSED)<br/>            comparison = string<br/>            value      = string<br/>          }))<br/>          finding_type = optional(object({ # Filter by finding type<br/>            comparison = string<br/>            value      = string<br/>          }))<br/>          first_observed_at = optional(object({ # Filter by first observation date/time<br/>            end_inclusive   = optional(string)  # End date (ISO 8601 format)<br/>            start_inclusive = optional(string)  # Start date (ISO 8601 format)<br/>          }))<br/>          inspector_score = optional(object({  # Filter by Inspector score range<br/>            lower_inclusive = optional(number) # Minimum score (0-10)<br/>            upper_inclusive = optional(number) # Maximum score (0-10)<br/>          }))<br/>          last_observed_at = optional(object({ # Filter by last observation date/time<br/>            end_inclusive   = optional(string) # End date (ISO 8601 format)<br/>            start_inclusive = optional(string) # Start date (ISO 8601 format)<br/>          }))<br/>          network_protocol = optional(object({ # Filter by network protocol<br/>            comparison = string<br/>            value      = string<br/>          }))<br/>          port_range = optional(object({       # Filter by port range<br/>            begin_inclusive = optional(number) # Start port number<br/>            end_inclusive   = optional(number) # End port number<br/>          }))<br/>          related_vulnerabilities = optional(object({ # Filter by related vulnerability IDs<br/>            comparison = string<br/>            value      = string<br/>          }))<br/>          resource_id = optional(object({ # Filter by resource ID<br/>            comparison = string<br/>            value      = string<br/>          }))<br/>          resource_tags = optional(object({ # Filter by resource tags<br/>            comparison = string             # Comparison operator<br/>            key        = string             # Tag key<br/>            value      = optional(string)   # Tag value (optional)<br/>          }))<br/>          resource_type = optional(object({ # Filter by resource type (EC2, ECR, LAMBDA)<br/>            comparison = string<br/>            value      = string<br/>          }))<br/>          severity = optional(object({ # Filter by severity (CRITICAL, HIGH, MEDIUM, LOW, INFORMATIONAL, UNTRIAGED)<br/>            comparison = string<br/>            value      = string<br/>          }))<br/>          title = optional(object({ # Filter by finding title<br/>            comparison = string<br/>            value      = string<br/>          }))<br/>          updated_at = optional(object({       # Filter by last update date/time<br/>            end_inclusive   = optional(string) # End date (ISO 8601 format)<br/>            start_inclusive = optional(string) # Start date (ISO 8601 format)<br/>          }))<br/>          vendor_severity = optional(object({ # Filter by vendor severity<br/>            comparison = string<br/>            value      = string<br/>          }))<br/>          vulnerability_id = optional(object({ # Filter by vulnerability ID (CVE ID, etc.)<br/>            comparison = string<br/>            value      = string<br/>          }))<br/>          vulnerability_source = optional(object({ # Filter by vulnerability source<br/>            comparison = string<br/>            value      = string<br/>          }))<br/>        }))<br/>      })), {})<br/>    }), {})<br/>    # AWS GuardDuty submodule configuration<br/>    guardduty = optional(object({<br/>      enabled                      = optional(bool, false)               # Enable/disable AWS GuardDuty for threat detection<br/>      finding_publishing_frequency = optional(string, "FIFTEEN_MINUTES") # Frequency for publishing findings: FIFTEEN_MINUTES, ONE_HOUR, SIX_HOURS<br/>      enable_s3_protection         = optional(bool, false)               # Enable S3 protection<br/>      enable_kubernetes_protection = optional(bool, false)               # Enable Kubernetes protection<br/>      enable_malware_protection    = optional(bool, false)               # Enable malware protection<br/>      filters = optional(map(object({                                    # Map of GuardDuty filters to create (key is filter name)<br/>        name        = string                                             # Filter name<br/>        description = optional(string)<br/>        action      = string              # Filter action: ARCHIVE or NOOP<br/>        rank        = optional(number, 1) # Filter rank (1 is highest priority)<br/>        finding_criteria = object({<br/>          criterion = map(object({<br/>            eq                    = optional(list(string), [])<br/>            neq                   = optional(list(string), [])<br/>            gt                    = optional(number)<br/>            gte                   = optional(number)<br/>            lt                    = optional(number)<br/>            lte                   = optional(number)<br/>            equals                = optional(list(string), [])<br/>            not_equals            = optional(list(string), [])<br/>            greater_than          = optional(number)<br/>            greater_than_or_equal = optional(number)<br/>            less_than             = optional(number)<br/>            less_than_or_equal    = optional(number)<br/>          }))<br/>        })<br/>      })), {})<br/>    }), {})<br/>    # Amazon Macie submodule configuration<br/>    macie = optional(object({<br/>      enabled                      = optional(bool, false)               # Enable/disable Amazon Macie for data security<br/>      finding_publishing_frequency = optional(string, "FIFTEEN_MINUTES") # Frequency for publishing findings: FIFTEEN_MINUTES, ONE_HOUR, SIX_HOURS<br/>      status                       = optional(string, "ENABLED")         # Macie status: ENABLED or PAUSED<br/>      findings_filters = optional(map(object({                           # Map of Macie findings filters to create (key is filter name)<br/>        name        = string                                             # Filter name<br/>        description = optional(string)<br/>        action      = string              # Filter action: ARCHIVE or NOOP<br/>        position    = optional(number, 1) # Filter position (1 is highest priority)<br/>        finding_criteria = object({<br/>          criterion = map(object({<br/>            eq                    = optional(list(string), [])<br/>            neq                   = optional(list(string), [])<br/>            gt                    = optional(number)<br/>            gte                   = optional(number)<br/>            lt                    = optional(number)<br/>            lte                   = optional(number)<br/>            equals                = optional(list(string), [])<br/>            not_equals            = optional(list(string), [])<br/>            greater_than          = optional(number)<br/>            greater_than_or_equal = optional(number)<br/>            less_than             = optional(number)<br/>            less_than_or_equal    = optional(number)<br/>          }))<br/>        })<br/>      })), {})<br/>    }), {})<br/>  })</pre> | `{}` | no |
| <a name="input_users"></a> [users](#input\_users) | List of users | <pre>list(object({<br/>    username          = string<br/>    policy_attachment = optional(list(string), [])<br/>    enforce_mfa       = optional(bool, true) # whether user should be placed into enforce mfa group, note that the enforce_mfa.enabled should be set to true to have this applied<br/>    create            = optional(bool, true) # whether the user should be created or not, so that existing iam user can be linked/placed into a group<br/>  }))</pre> | `[]` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_users"></a> [users](#output\_users) | created users data |
<!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
